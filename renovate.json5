// Note: we use JSON5 to be able to use comments
{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  extends: [
    "config:base",
    ":disableRateLimiting",
    ":rebaseStalePrs"
  ],
  "github-actions": {
    enabled: false
  },
  baseBranches: [
    "main"
  ],
  repositories: [

  ],
  ignorePaths: [
    "terraform/**",
    "certstrap/**",
    "cf-acceptance-tests/**",
    "cf-uaac/**",
    "concourse-keyval-resource/**",
    "concourse-pool-resource/**",
    "fast-startup-and-shutdown/**",
    "golang/**",
    "json-minify/**",
    "keyval-resource/**",
    "middleman/**",
    "node/**",
    "node-chromium/**",
    "olhtbr-metadata-resource/**",
    "paas-prometheus-exporter/**",
    "psql/**",
    "ruby/**",
    "ruby-base/**",
    "self-update-pipelines/**",
    "spec/**",
    "ubuntu/**"
  ],
  packageRules: [
    {
      description: "@o-orand assignments",
      matchPackagePatterns: [
        "*"
      ],
      assignees: [
        "o-orand"
      ]
    },
    {
      matchPackagePatterns: [".*"],
      addLabels: ["{{datasource}}","{{depName}}"]
    },
    {
      description: "Ruby: update spec files",
      matchDepNames: "ruby",
      matchFiles: ["**/*_spec\\.rb"]
    }
  ],

  regexManagers: [
    {
      description: "https://regex101.com/r/QUjPL3/1",
      fileMatch: [".*/.*_spec\\.rb"],
      matchStrings: [
        "\\s*RUBY_VERSION\\s*=\\s*\"(?<currentValue>[a-z0-9\\.\\/\\-\\+]*)\".*$"
      ],
      depNameTemplate: "ruby",
      datasourceTemplate: "docker"
    },
    {
      fileMatch: [".*/Dockerfile$", ".*/.*_spec\\.rb"],
      "matchStrings": [
        // For dockerfile: https://regex101.com/r/QUjPL3/3
        "datasource=(?<datasource>.+) depName=(?<depName>[\\w\\d\\//\\-\\_]+)\\nENV .+_VERSION ?\\\"?v?(?<currentValue>[\\w\\d\\/\\-\\.\\_]+)\\\"?\\s*",
        // For spec files: https://regex101.com/r/ifWHDK/2
        "^.+_VERSION\\s*=\\s*[\\\"\\']?(?<currentValue>[\\w\\d\\/\\-\\.\\_]+)?[\\\"\\']?\\s* #\\s*renovate: datasource=(?<datasource>.+) depName=(?<depName>[\\w\\d\\//\\-\\_]+)( versioning=(?<versioning>.+))?\\s*"
      ],
      datasourceTemplate: "github-releases",
      versioningTemplate: "regex:^v?(?<major>\\d+)\\.(?<minor>\\d+)\\.(?<patch>\\d+)?$"
    }
  ]
}



